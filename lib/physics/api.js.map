{"version":3,"sources":["physics/api.js"],"names":[],"mappings":"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","file":"api.js","sourcesContent":["import * as THREE from 'three';\r\n\r\nconst MESSAGE_TYPES = {\r\n  WORLDREPORT: 0,\r\n  COLLISIONREPORT: 1,\r\n  VEHICLEREPORT: 2,\r\n  CONSTRAINTREPORT: 3\r\n};\r\n\r\nconst REPORT_ITEMSIZE = 14,\r\n  COLLISIONREPORT_ITEMSIZE = 5,\r\n  VEHICLEREPORT_ITEMSIZE = 9,\r\n  CONSTRAINTREPORT_ITEMSIZE = 6;\r\n\r\nconst temp1Vector3 = new THREE.Vector3(),\r\n  temp2Vector3 = new THREE.Vector3(),\r\n  temp1Matrix4 = new THREE.Matrix4(),\r\n  temp1Quat = new THREE.Quaternion();\r\n\r\nconst getEulerXYZFromQuaternion = (x, y, z, w) => {\r\n  return new THREE.Vector3(\r\n    Math.atan2(2 * (x * w - y * z), (w * w - x * x - y * y + z * z)),\r\n    Math.asin(2 * (x * z + y * w)),\r\n    Math.atan2(2 * (z * w - x * y), (w * w + x * x - y * y - z * z))\r\n  );\r\n};\r\n\r\nconst createMaterial = (material, friction, restitution) => {\r\n  let physijs_material = function () {\r\n  };\r\n\r\n  physijs_material.prototype = material;\r\n  physijs_material = new physijs_material();\r\n\r\n  physijs_material._physijs = {\r\n    id: material.id,\r\n    friction: friction === undefined ? 0.8 : friction,\r\n    restitution: restitution === undefined ? 0.2 : restitution\r\n  };\r\n\r\n  return physijs_material;\r\n}\r\n\r\nconst getQuatertionFromEuler = (x, y, z) => {\r\n  const c1 = Math.cos(y);\r\n  const s1 = Math.sin(y);\r\n  const c2 = Math.cos(-z);\r\n  const s2 = Math.sin(-z);\r\n  const c3 = Math.cos(x);\r\n  const s3 = Math.sin(x);\r\n  const c1c2 = c1 * c2;\r\n  const s1s2 = s1 * s2;\r\n\r\n  return {\r\n    w: c1c2 * c3 - s1s2 * s3,\r\n    x: c1c2 * s3 + s1s2 * c3,\r\n    y: s1 * c2 * c3 + c1 * s2 * s3,\r\n    z: c1 * s2 * c3 - s1 * c2 * s3\r\n  };\r\n};\r\n\r\nconst convertWorldPositionToObject = (position, object) => {\r\n  temp1Matrix4.identity(); // reset temp matrix\r\n\r\n  // Set the temp matrix's rotation to the object's rotation\r\n  temp1Matrix4.identity().makeRotationFromQuaternion(object.quaternion);\r\n\r\n  // Invert rotation matrix in order to \"unrotate\" a point back to object space\r\n  temp1Matrix4.getInverse(temp1Matrix4);\r\n\r\n  // Yay! Temp vars!\r\n  temp1Vector3.copy(position);\r\n  temp2Vector3.copy(object.position);\r\n\r\n  // Apply the rotation\r\n  return temp1Vector3.sub(temp2Vector3).applyMatrix4(temp1Matrix4);\r\n};\r\n\r\nconst addObjectChildren = function (parent, object) {\r\n  for (let i = 0; i < object.children.length; i++) {\r\n    if (object.children[i]._physijs) {\r\n      object.children[i].updateMatrix();\r\n      object.children[i].updateMatrixWorld();\r\n\r\n      temp1Vector3.setFromMatrixPosition(object.children[i].matrixWorld);\r\n      temp1Quat.setFromRotationMatrix(object.children[i].matrixWorld);\r\n\r\n      object.children[i]._physijs.position_offset = {\r\n        x: temp1Vector3.x,\r\n        y: temp1Vector3.y,\r\n        z: temp1Vector3.z\r\n      };\r\n\r\n      object.children[i]._physijs.rotation = {\r\n        x: temp1Quat.x,\r\n        y: temp1Quat.y,\r\n        z: temp1Quat.z,\r\n        w: temp1Quat.w\r\n      };\r\n\r\n      parent._physijs.children.push(object.children[i]._physijs);\r\n    }\r\n\r\n    addObjectChildren(parent, object.children[i]);\r\n  }\r\n};\r\n\r\nconst getObjectId = (() => {\r\n  let _id = 1;\r\n  return () => {\r\n    return _id++;\r\n  };\r\n})();\r\n\r\nexport {\r\n  getEulerXYZFromQuaternion,\r\n  getQuatertionFromEuler,\r\n  convertWorldPositionToObject,\r\n  getObjectId,\r\n  addObjectChildren,\r\n  createMaterial,\r\n\r\n  MESSAGE_TYPES,\r\n  REPORT_ITEMSIZE,\r\n  COLLISIONREPORT_ITEMSIZE,\r\n  VEHICLEREPORT_ITEMSIZE,\r\n  CONSTRAINTREPORT_ITEMSIZE,\r\n\r\n  temp1Vector3,\r\n  temp2Vector3,\r\n  temp1Matrix4,\r\n  temp1Quat\r\n};\r\n"]}