{"version":3,"sources":["core/Camera.js"],"names":[],"mappings":"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","file":"Camera.js","sourcesContent":["import * as THREE from 'three';\r\n\r\nimport {Loop} from '../extensions/Loop';\r\nimport {defaults} from '../utils/defaults';\r\nimport {WHSObject} from './Object';\r\n\r\nclass Camera extends WHSObject {\r\n  constructor(params, type) {\r\n    if (!type) console.error('@constructor: Please specify \" type \".');\r\n\r\n    const _set = (x, y, z) => {\r\n      this.x = x;\r\n      this.y = y;\r\n      this.z = z;\r\n    };\r\n\r\n    params.useTarget = Boolean(params.target);\r\n\r\n    super({\r\n      camera: {\r\n        fov: 45,\r\n        aspect: window.innerWidth / window.innerHeight,\r\n        near: 1,\r\n        far: 1000,\r\n        left: window.innerWidth / -2,\r\n        right: window.innerWidth / 2,\r\n        top: window.innerHeight / 2,\r\n        bottom: window.innerHeight / -2,\r\n        cubeResolution: 128\r\n      },\r\n\r\n      helper: false,\r\n\r\n      pos: {\r\n        x: 0,\r\n        y: 0,\r\n        z: 0,\r\n        set: _set\r\n      },\r\n\r\n      rot: {\r\n        x: 0,\r\n        y: 0,\r\n        z: 0,\r\n        set: _set\r\n      },\r\n\r\n      target: {\r\n        x: 0,\r\n        y: 0,\r\n        z: 0,\r\n        set: _set\r\n      }\r\n    });\r\n\r\n    super.setParams(params);\r\n\r\n    const scope = Object.assign(this, {\r\n      _type: type,\r\n      helper: false\r\n    });\r\n\r\n    if (defaults.debug)\r\n      console.debug(`@WHS.Camera: Camera ${scope._type} found.`, scope);\r\n\r\n    return scope;\r\n  }\r\n\r\n  wrap(...tags) {\r\n    return new Promise((resolve, reject) => {\r\n      try {\r\n        this.position.set(\r\n          this.__params.pos.x,\r\n          this.__params.pos.y,\r\n          this.__params.pos.z\r\n        );\r\n\r\n        this.rotation.set(\r\n          this.__params.rot.x,\r\n          this.__params.rot.y,\r\n          this.__params.rot.z\r\n        );\r\n\r\n        if (this.__params.useTarget) this.lookAt(this.__params.target);\r\n\r\n        if (this.__params.helper) {\r\n          this.helper = new THREE.CameraHelper(\r\n            this.getNative()\r\n          );\r\n        }\r\n\r\n        tags.forEach(tag => {\r\n          this[tag] = true;\r\n        });\r\n\r\n        if (defaults.debug)\r\n          console.debug(`@WHS.Camera: Camera ${this._type} is ready.`, this);\r\n\r\n        this.emit('ready');\r\n\r\n        resolve(this);\r\n      } catch (err) {\r\n        console.error(err.message);\r\n        reject();\r\n      }\r\n    });\r\n  }\r\n\r\n  addTo(parent) {\r\n    this.parent = parent;\r\n\r\n    const _helper = this.helper,\r\n      _scope = this;\r\n\r\n    return new Promise((resolve, reject) => {\r\n      try {\r\n        _scope.parent.getScene().add(_scope.getNative());\r\n        _scope.parent.children.push(_scope);\r\n\r\n        if (_helper) _scope.parent.getScene().add(_helper);\r\n      } catch (err) {\r\n        console.error(err.message);\r\n        reject();\r\n      } finally {\r\n        if (defaults.debug) {\r\n          console.debug(\r\n            `@WHS.Camera: Camera ${_scope._type} was added to world.`,\r\n            [_scope, _scope.parent]\r\n          );\r\n        }\r\n\r\n        resolve(_scope);\r\n\r\n        _scope.emit('ready');\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Clone camera.\r\n   */\r\n  clone() {\r\n    return new Shape(this.__params, this._type).copy(this);\r\n  }\r\n\r\n  /**\r\n   * Copy camera.\r\n   *\r\n   * @param {WHS.Camera} source - Source object, that will be applied to this.\r\n   */\r\n  copy(source) {\r\n    this.mesh = source.mesh.clone();\r\n\r\n    this.wrap();\r\n\r\n    this.position = source.position.clone();\r\n    this.rotation = source.rotation.clone();\r\n\r\n    this._type = source._type;\r\n\r\n    return this;\r\n  }\r\n\r\n  get position() {\r\n    return this.getNative().position;\r\n  }\r\n\r\n  set position(vector3) {\r\n    return this.getNative().position.copy(vector3);\r\n  }\r\n\r\n  get rotation() {\r\n    return this.getNative().rotation;\r\n  }\r\n\r\n  set rotation(euler) {\r\n    return this.getNative().rotation.copy(euler);\r\n  }\r\n\r\n  follow(curve, time = 1000, loop, lookAt) {\r\n    const _scope = this,\r\n      gEnd = time;\r\n\r\n    let animation = new Loop(clock => {\r\n      const u = clock.getElapsedTime() * 1000 / gEnd,\r\n        vec1 = curve.getPoint(u),\r\n        vec2 = curve.getPoint((u + 0.01) % 1);\r\n\r\n      _scope.position.set(vec1.x, vec1.y, vec1.z);\r\n\r\n      if (!lookAt) _scope.lookAt(vec2);\r\n      else if (lookAt instanceof TVector3) _scope.lookAt(lookAt);\r\n      else if (\r\n          lookAt instanceof TCurve\r\n          || lookAt instanceof TCurvePath\r\n        ) _scope.lookAt(lookAt.getPoint(u));\r\n    });\r\n\r\n    animation.start();\r\n\r\n    if (loop) {\r\n      setInterval(() => {\r\n        animation.stop();\r\n\r\n        animation = new Loop(clock => {\r\n          const u = clock.getElapsedTime() * 1000 / gEnd,\r\n            vec1 = curve.getPoint(u),\r\n            vec2 = curve.getPoint((u + 0.01) % 1);\r\n\r\n          _scope.position.set(vec1.x, vec1.y, vec1.z);\r\n\r\n          if (!lookAt) _scope.lookAt(vec2);\r\n          else if (lookAt instanceof TVector3) _scope.lookAt(lookAt);\r\n          else if (\r\n              lookAt instanceof TCurve\r\n              || lookAt instanceof TCurvePath\r\n            ) _scope.lookAt(lookAt.getPoint(u));\r\n        });\r\n\r\n        animation.start();\r\n      }, time);\r\n    } else {\r\n      setTimeout(() => {\r\n        animation.stop();\r\n      }, time);\r\n    }\r\n  }\r\n\r\n  lookAt(vector3) {\r\n    return this.getNative().lookAt(vector3);\r\n  }\r\n\r\n  getWorldDirection(vector3) {\r\n    return this.getNative().getWorldDirection(vector3);\r\n  }\r\n}\r\n\r\nexport {\r\n  Camera\r\n};\r\n"]}