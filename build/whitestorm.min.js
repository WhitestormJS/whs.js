/**
 * Â© Alexander Buzin, 2014-2015
 * Site: http://alexbuzin.me/
 * Email: alexbuzin88@gmail.com
*/

"use strict";function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Events(e){var t={},r=[];e=e||this,e.on=function(e,r,a){(t[e]=t[e]||[]).push([r,a])},e.off=function(e,a){e||(t={});for(var n=t[e]||r,o=n.length=a?n.length:0;o--;)a==n[o][0]&&n.splice(o,1)},e.emit=function(e){for(var a,n=t[e]||r,o=0;a=n[o++];)a[0].apply(a[1],r.slice.call(arguments,1))}}function addCSSRule(e,t,r,a){e.insertRule?e.insertRule(t+"{"+r+"}",a):e.addRule&&e.addRule(t,r,a)}var _get=function e(t,r,a){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,r);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,a)}if("value"in n)return n.value;var s=n.get;if(void 0!==s)return s.call(a)},_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};THREE.OrbitControls=function(e,t){function r(){return 2*Math.PI/60/60*p.autoRotateSpeed}function a(){return Math.pow(.95,p.zoomSpeed)}function n(e){if(p.enabled!==!1){if(e.preventDefault(),0===e.button){if(p.noRotate===!0)return;k=C.ROTATE,d.set(e.clientX,e.clientY)}else if(1===e.button){if(p.noZoom===!0)return;k=C.DOLLY,b.set(e.clientX,e.clientY)}else if(2===e.button){if(p.noPan===!0)return;k=C.PAN,f.set(e.clientX,e.clientY)}p.domElement.addEventListener("mousemove",o,!1),p.domElement.addEventListener("mouseup",s,!1)}}function o(e){if(p.enabled!==!1){e.preventDefault();var t=p.domElement===document?p.domElement.body:p.domElement;if(k===C.ROTATE){if(p.noRotate===!0)return;g.set(e.clientX,e.clientY),y.subVectors(g,d),p.rotateLeft(2*Math.PI*y.x/t.clientWidth*p.rotateSpeed),p.rotateUp(2*Math.PI*y.y/t.clientHeight*p.rotateSpeed),d.copy(g)}else if(k===C.DOLLY){if(p.noZoom===!0)return;w.set(e.clientX,e.clientY),S.subVectors(w,b),S.y>0?p.dollyIn():p.dollyOut(),b.copy(w)}else if(k===C.PAN){if(p.noPan===!0)return;v.set(e.clientX,e.clientY),_.subVectors(v,f),p.pan(_),f.copy(v)}p.update()}}function s(){p.enabled!==!1&&(p.domElement.removeEventListener("mousemove",o,!1),p.domElement.removeEventListener("mouseup",s,!1),k=C.NONE)}function i(e){if(p.enabled!==!1&&p.noZoom!==!0){var t=0;e.wheelDelta?t=e.wheelDelta:e.detail&&(t=-e.detail),t>0?p.dollyOut():p.dollyIn()}}function l(e){if(p.enabled!==!1&&p.noKeys!==!0&&p.noPan!==!0){var t=!1;switch(e.keyCode){case p.keys.UP:p.pan(new THREE.Vector2(0,p.keyPanSpeed)),t=!0;break;case p.keys.BOTTOM:p.pan(new THREE.Vector2(0,-p.keyPanSpeed)),t=!0;break;case p.keys.LEFT:p.pan(new THREE.Vector2(p.keyPanSpeed,0)),t=!0;break;case p.keys.RIGHT:p.pan(new THREE.Vector2(-p.keyPanSpeed,0)),t=!0}t&&p.update()}}function c(e){if(p.enabled!==!1)switch(e.touches.length){case 1:if(p.noRotate===!0)return;k=C.TOUCH_ROTATE,d.set(e.touches[0].pageX,e.touches[0].pageY);break;case 2:if(p.noZoom===!0)return;k=C.TOUCH_DOLLY;var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,a=Math.sqrt(t*t+r*r);b.set(0,a);break;case 3:if(p.noPan===!0)return;k=C.TOUCH_PAN,f.set(e.touches[0].pageX,e.touches[0].pageY);break;default:k=C.NONE}}function u(e){if(p.enabled!==!1){e.preventDefault(),e.stopPropagation();var t=p.domElement===document?p.domElement.body:p.domElement;switch(e.touches.length){case 1:if(p.noRotate===!0)return;if(k!==C.TOUCH_ROTATE)return;g.set(e.touches[0].pageX,e.touches[0].pageY),y.subVectors(g,d),p.rotateLeft(2*Math.PI*y.x/t.clientWidth*p.rotateSpeed),p.rotateUp(2*Math.PI*y.y/t.clientHeight*p.rotateSpeed),d.copy(g);break;case 2:if(p.noZoom===!0)return;if(k!==C.TOUCH_DOLLY)return;var r=e.touches[0].pageX-e.touches[1].pageX,a=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(r*r+a*a);w.set(0,n),S.subVectors(w,b),S.y>0?p.dollyOut():p.dollyIn(),b.copy(w);break;case 3:if(p.noPan===!0)return;if(k!==C.TOUCH_PAN)return;v.set(e.touches[0].pageX,e.touches[0].pageY),_.subVectors(v,f),p.pan(_),f.copy(v);break;default:k=C.NONE}}}function h(){p.enabled!==!1&&(k=C.NONE)}this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.center=this.target,this.noZoom=!1,this.zoomSpeed=1,this.minDistance=0,this.maxDistance=1/0,this.noRotate=!1,this.rotateSpeed=1,this.noPan=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.noKeys=!1,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};var p=this,m=1e-6,d=new THREE.Vector2,g=new THREE.Vector2,y=new THREE.Vector2,f=new THREE.Vector2,v=new THREE.Vector2,_=new THREE.Vector2,b=new THREE.Vector2,w=new THREE.Vector2,S=new THREE.Vector2,H=0,E=0,P=1,O=new THREE.Vector3,W=new THREE.Vector3,C={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},k=C.NONE,T={type:"change"};this.rotateLeft=function(e){void 0===e&&(e=r()),E-=e},this.rotateUp=function(e){void 0===e&&(e=r()),H-=e},this.panLeft=function(e){var t=new THREE.Vector3,r=this.object.matrix.elements;t.set(r[0],r[1],r[2]),t.multiplyScalar(-e),O.add(t)},this.panUp=function(e){var t=new THREE.Vector3,r=this.object.matrix.elements;t.set(r[4],r[5],r[6]),t.multiplyScalar(e),O.add(t)},this.pan=function(e){var t=p.domElement===document?p.domElement.body:p.domElement;if(void 0!==p.object.fov){var r=p.object.position,a=r.clone().sub(p.target),n=a.length();n*=Math.tan(p.object.fov/2*Math.PI/180),p.panLeft(2*e.x*n/t.clientHeight),p.panUp(2*e.y*n/t.clientHeight)}else void 0!==p.object.top?(p.panLeft(e.x*(p.object.right-p.object.left)/t.clientWidth),p.panUp(e.y*(p.object.top-p.object.bottom)/t.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")},this.dollyIn=function(e){void 0===e&&(e=a()),P/=e},this.dollyOut=function(e){void 0===e&&(e=a()),P*=e},this.update=function(){var e=this.object.position,t=e.clone().sub(this.target),a=Math.atan2(t.x,t.z),n=Math.atan2(Math.sqrt(t.x*t.x+t.z*t.z),t.y);this.autoRotate&&this.rotateLeft(r()),a+=E,n+=H,n=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,n)),n=Math.max(m,Math.min(Math.PI-m,n));var o=t.length()*P;o=Math.max(this.minDistance,Math.min(this.maxDistance,o)),this.target.add(O),t.x=o*Math.sin(n)*Math.sin(a),t.y=o*Math.cos(n),t.z=o*Math.sin(n)*Math.cos(a),e.copy(this.target).add(t),this.object.lookAt(this.target),E=0,H=0,P=1,O.set(0,0,0),W.distanceTo(this.object.position)>0&&(this.dispatchEvent(T),W.copy(this.object.position))},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousedown",n,!1),this.domElement.addEventListener("mousewheel",i,!1),this.domElement.addEventListener("DOMMouseScroll",i,!1),this.domElement.addEventListener("keydown",l,!1),this.domElement.addEventListener("touchstart",c,!1),this.domElement.addEventListener("touchend",h,!1),this.domElement.addEventListener("touchmove",u,!1)},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);var Stats=function(){function e(e,t,r){return e=document.createElement(e),e.id=t,e.style.cssText=r,e}function t(t,r,a){var n=e("div",t,"padding:0 0 3px 3px;text-align:left;background:"+a),o=e("div",t+"Text","font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px;color:"+r);for(o.innerHTML=t.toUpperCase(),n.appendChild(o),t=e("div",t+"Graph","width:74px;height:30px;background:"+r),n.appendChild(t),r=0;74>r;r++)t.appendChild(e("span","","width:1px;height:30px;float:left;opacity:0.9;background:"+a));return n}function r(e){for(var t=c.children,r=0;r<t.length;r++)t[r].style.display=r===e?"block":"none";l=e}function a(e,t){e.appendChild(e.firstChild).style.height=Math.min(30,30-30*t)+"px"}var n=self.performance&&self.performance.now?self.performance.now.bind(performance):Date.now,o=n(),s=o,i=0,l=0,c=e("div","stats","width:80px;opacity:0.9;cursor:pointer");c.addEventListener("mousedown",function(e){e.preventDefault(),r(++l%c.children.length)},!1);var u=0,h=1/0,p=0,m=t("fps","#0ff","#002"),d=m.children[0],g=m.children[1];c.appendChild(m);var y=0,f=1/0,v=0,m=t("ms","#0f0","#020"),_=m.children[0],b=m.children[1];if(c.appendChild(m),self.performance&&self.performance.memory){var w=0,S=1/0,H=0,m=t("mb","#f08","#201"),E=m.children[0],P=m.children[1];c.appendChild(m)}return r(l),{REVISION:14,domElement:c,setMode:r,begin:function(){o=n()},end:function(){var e=n();if(y=e-o,f=Math.min(f,y),v=Math.max(v,y),_.textContent=(0|y)+" MS ("+(0|f)+"-"+(0|v)+")",a(b,y/200),i++,e>s+1e3&&(u=Math.round(1e3*i/(e-s)),h=Math.min(h,u),p=Math.max(p,u),d.textContent=u+" FPS ("+h+"-"+p+")",a(g,u/100),s=e,i=0,void 0!==w)){var t=performance.memory.usedJSHeapSize,r=performance.memory.jsHeapSizeLimit;w=Math.round(9.54e-7*t),S=Math.min(S,w),H=Math.max(H,w),E.textContent=w+" MB ("+S+"-"+H+")",a(P,t/r)}return e},update:function(){o=this.end()}}};"object"===("undefined"==typeof module?"undefined":_typeof(module))&&(module.exports=Stats),THREE.SubdivisionModifier=function(e){this.subdivisions=void 0===e?1:e},THREE.SubdivisionModifier.prototype.modify=function(e){for(var t=this.subdivisions;t-- >0;)this.smooth(e);delete e.__tmpVertices,e.computeFaceNormals(),e.computeVertexNormals()},function(){function e(e,t,r){var a=Math.min(e,t),n=Math.max(e,t),o=a+"_"+n;return r[o]}function t(e,t,r,a,n,o){var s,i=Math.min(e,t),l=Math.max(e,t),c=i+"_"+l;if(c in a)s=a[c];else{var u=r[i],h=r[l];s={a:u,b:h,newEdge:null,faces:[]},a[c]=s}s.faces.push(n),o[e].edges.push(s),o[t].edges.push(s)}function r(e,r,a,n){var o,s,i;for(o=0,s=e.length;s>o;o++)a[o]={edges:[]};for(o=0,s=r.length;s>o;o++)i=r[o],t(i.a,i.b,e,n,i,a),t(i.b,i.c,e,n,i,a),t(i.c,i.a,e,n,i,a)}function a(e,t,r,a){e.push(new THREE.Face3(t,r,a))}var n=!1,o=["a","b","c"];THREE.SubdivisionModifier.prototype.smooth=function(t){var s,i,l,c,u,h,p,m,d,g,y,y,f,v,_=new THREE.Vector3;s=t.vertices,i=t.faces,g=new Array(s.length),y={},r(s,i,g,y),f=[];var b,w,S,H,E,P,O;for(h in y){for(w=y[h],S=new THREE.Vector3,E=3/8,P=1/8,O=w.faces.length,2!=O&&(E=.5,P=0,1!=O&&n&&console.warn("Subdivision Modifier: Number of connected faces != 2, is: ",O,w)),S.addVectors(w.a,w.b).multiplyScalar(E),_.set(0,0,0),m=0;O>m;m++){for(H=w.faces[m],d=0;3>d&&(b=s[H[o[d]]],b===w.a||b===w.b);d++);_.add(b)}_.multiplyScalar(P),S.add(_),w.newEdge=f.length,f.push(S)}var W,C,k,T,x,R,N;for(v=[],h=0,p=s.length;p>h;h++){for(R=s[h],x=g[h].edges,u=x.length,3==u?W=3/16:u>3&&(W=3/(8*u)),C=1-u*W,k=W,2>=u&&(2==u?(n&&console.warn("2 connecting edges",x),C=.75,k=1/8):1==u?n&&console.warn("only 1 connecting edge"):0==u&&n&&console.warn("0 connecting edges")),N=R.clone().multiplyScalar(C),_.set(0,0,0),m=0;u>m;m++)T=x[m],b=T.a!==R?T.a:T.b,_.add(b);_.multiplyScalar(k),N.add(_),v.push(N)}l=v.concat(f);var M,j,L,A=v.length;for(c=[],h=0,p=i.length;p>h;h++)H=i[h],M=e(H.a,H.b,y).newEdge+A,j=e(H.b,H.c,y).newEdge+A,L=e(H.c,H.a,y).newEdge+A,a(c,M,j,L),a(c,H.a,M,L),a(c,H.b,j,M),a(c,H.c,L,j);t.vertices=l,t.faces=c}}(),addCSSRule(document.styleSheets[0],"@keyframes fadeOut","to {opacity: 0}",0),addCSSRule(document.styleSheets[0],"@keyframes fadeIn","from {opacity: 0} to {opacity: 1}",0),Element.prototype.fadeOut=function(e){this.style.webkitAnimationDuration=(e||1)+"s",this.style.webkitAnimationName="fadeOut",this.style.webkitAnimationPlayState="running",this.addEventListener("animationend",function(){this.style.display="none",this.style.webkitAnimationPlayState="paused"})},Element.prototype.fadeIn=function(e,t){this.style.display=t||"block",this.style.webkitAnimationDuration=(e||1)+"s",this.style.webkitAnimationName="fadeIn",this.style.webkitAnimationPlayState="running",this.addEventListener("animationend",function(){this.style.display=t||"block"})},"undefined"==typeof Array.isArray&&(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),function(){if(!MouseEvent.prototype.hasOwnProperty("movementX")||!MouseEvent.prototype.hasOwnProperty("mozMovementX")){var e={lastX:0,lastY:0};MouseEvent.prototype.getMovementX=function(){var t=this.clientX-e.lastX;return e.lastX=this.clientX,t},MouseEvent.prototype.getMovementY=function(){var t=this.clientY-e.lastY;return e.lastY=this.clientY,t}}}(),Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(void 0===e||null===e)throw new TypeError("Cannot convert first argument to object");for(var t=Object(e),r=1;r<arguments.length;r++){var a=arguments[r];if(void 0!==a&&null!==a){a=Object(a);for(var n=Object.keys(a),o=0,s=n.length;s>o;o++){var i=n[o],l=Object.getOwnPropertyDescriptor(a,i);void 0!==l&&l.enumerable&&(t[i]=a[i])}}}return t}});var WHS={REVISION:"r8",loader:{JSON:new THREE.JSONLoader,Texture:new THREE.TextureLoader,Font:new THREE.FontLoader},API:{},_settings:{assets:"./assets",path_worker:"../libs/physijs_worker.js",path_ammo:"../libs/ammo.js"},debug:!1,loops:[]};console.log("WhitestormJS",WHS.REVISION);var native=new WeakMap;WHS.API.loadJSON=function(e,t,r){return WHS.loader.JSON.load(e,t,r)},WHS.API.loadTexture=function(e,t,r,a){return WHS.loader.Texture.load(e,t,r,a)},WHS.API.loadFont=function(e,t,r,a){return WHS.loader.Font.load(e,t,r,a)},"function"==typeof define&&define.amd?define("whitestorm",WHS):"undefined"!=typeof exports&&"undefined"!=typeof module&&(module.exports=WHS),WHS.Object=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=arguments.length<=1||void 0===arguments[1]?!0:arguments[1];_classCallCheck(this,e);var a=r?Object.assign(this,{__whsobject:!0,__releaseTime:(new Date).getTime(),__params:{},__defaults:t,parent:null,children:[]},new Events):Object.assign(this,{__whsobject:!0,__releaseTime:(new Date).getTime(),__params:{}},new Events);return a}return _createClass(e,[{key:"setParams",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this.__params=WHS.API.extend(e,this.__defaults)}},{key:"updateParams",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this.__params=WHS.API.extend(e,this.__params)}}]),e}(),WHS.Camera=function(e){function t(e,r){var a;_classCallCheck(this,t),r||console.error('@constructor: Please specify " type ".');var n=function(e,t,r){this.x=e,this.y=t,this.z=r};e.useTarget=!!e.target;var o=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,{camera:{fov:45,aspect:window.innerWidth/window.innerHeight,near:1,far:1e3,left:window.innerWidth/-2,right:window.innerWidth/2,top:window.innerHeight/2,bottom:window.innerHeight/-2,cubeResolution:128},helper:!1,pos:{x:0,y:0,z:0,set:n},rot:{x:0,y:0,z:0,set:n},target:{x:0,y:0,z:0,set:n}}));_get(Object.getPrototypeOf(t.prototype),"setParams",o).call(o,e);var s=Object.assign(o,{_type:r,helper:!1});return WHS.debug&&console.debug("@WHS.Camera: Camera "+s._type+" found.",s),a=s,_possibleConstructorReturn(o,a)}return _inherits(t,e),_createClass(t,[{key:"wrap",value:function(){for(var e=arguments.length,t=Array(e),r=0;e>r;r++)t[r]=arguments[r];var a=this;return new Promise(function(e,r){try{a.position.set(a.__params.pos.x,a.__params.pos.y,a.__params.pos.z),a.rotation.set(a.__params.rot.x,a.__params.rot.y,a.__params.rot.z),a.__params.useTarget&&a.lookAt(a.__params.target),a.__params.helper&&(a.helper=new THREE.CameraHelper(a.getNative())),t.forEach(function(e){a[e]=!0}),WHS.debug&&console.debug("@WHS.Camera: Camera "+a._type+" is ready.",a),a.emit("ready"),e(a)}catch(n){console.error(n.message),r()}})}},{key:"addTo",value:function(e){this.parent=e;var t=this.helper,r=this;return new Promise(function(e,a){try{r.parent.getScene().add(r.getNative()),r.parent.children.push(r),t&&r.parent.getScene().add(t)}catch(n){console.error(n.message),a()}finally{WHS.debug&&console.debug("@WHS.Camera: Camera "+r._type+" was added to world.",[r,r.parent]),e(r),r.emit("ready")}})}},{key:"clone",value:function(){return new WHS.Shape(this.__params,this._type).copy(this)}},{key:"copy",value:function(e){return this.mesh=e.mesh.clone(),this.wrap(),this.position=e.position.clone(),this.rotation=e.rotation.clone(),this._type=e._type,this}},{key:"setNative",value:function(e){return native.set(this,e)}},{key:"getNative",value:function(){return native.get(this)}},{key:"follow",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?1e3:arguments[1],r=arguments[2],a=arguments[3],n=this,o=t,s=new WHS.loop(function(t){var r=1e3*t.getElapsedTime()/o,s=e.getPoint(r),i=e.getPoint((r+.01)%1);n.position.set(s.x,s.y,s.z),a?a instanceof THREE.Vector3?n.lookAt(a):(a instanceof THREE.Curve||a instanceof THREE.CurvePath)&&n.lookAt(a.getPoint(r)):n.lookAt(i)});s.start(),r?setInterval(function(){s.stop(),s=new WHS.loop(function(t){var r=1e3*t.getElapsedTime()/o,s=e.getPoint(r),i=e.getPoint((r+.01)%1);n.position.set(s.x,s.y,s.z),a?a instanceof THREE.Vector3?n.lookAt(a):(a instanceof THREE.Curve||a instanceof THREE.CurvePath)&&n.lookAt(a.getPoint(r)):n.lookAt(i)}),s.start()},t):setTimeout(function(){s.stop()},t)}},{key:"lookAt",value:function(e){return this.getNative().lookAt(e)}},{key:"getWorldDirection",value:function(e){return this.getNative().getWorldDirection(e)}},{key:"position",get:function(){return this.getNative().position},set:function(e){return this.getNative().position.copy(e)}},{key:"rotation",get:function(){return this.getNative().rotation},set:function(e){return this.getNative().rotation.copy(e)}}]),t}(WHS.Object),WHS.Curve=function(e){function t(e){var r;_classCallCheck(this,t);var a=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,{geometry:{curve:!1,points:50}}));_get(Object.getPrototypeOf(t.prototype),"setParams",a).call(a,e);var n=new THREE.Geometry;n.vertices=e.geometry.curve.getPoints(e.geometry.points);var o=new THREE.Line(n,WHS.API.loadMaterial(e.material,!1)._material);a.setNative(o);var s=Object.assign(a,{_type:"curve",__path:e.geometry.curve});return r=s,_possibleConstructorReturn(a,r)}return _inherits(t,e),_createClass(t,[{key:"addTo",value:function(e){this.parent=e;var t=this;return new Promise(function(e,r){try{t.parent.getScene().add(t.getNative()),t.parent.children.push(t)}catch(a){console.error(a.message),r()}finally{WHS.debug&&console.debug("@WHS.Curve: Curve "+t._type+" was added to world.",[t,t.parent]),e(t)}})}},{key:"setNative",value:function(e){return native.set(this,e)}},{key:"getNative",value:function(){return native.get(this)}},{key:"clone",value:function(){return new WHS.Curve(this.__params).copy(this)}},{key:"copy",value:function(e){return this.setNative(e.getNative().clone()),this._type=e._type,this}},{key:"remove",value:function(){return this.parent.getScene().remove(this.getNative()),this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent=null,this.emit("remove"),WHS.debug&&console.debug("@WHS.Curve: Curve "+this._type+" was removed from world",[_scope]),this}}]),t}(WHS.Object),WHS.Light=function(e){function t(e,r){var a;_classCallCheck(this,t),r||console.error('@constructor: Please specify " type ".');var n=function(e,t,r){this.x=e,this.y=t,this.z=r},o=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,{light:{color:16777215,skyColor:16777215,groundColor:16777215,intensity:1,distance:100,angle:Math.PI/3,exponent:0,decay:1},helper:!1,shadowmap:{cast:!0,bias:0,width:1024,height:1024,near:!0,far:400,fov:60,darkness:.3,top:200,bottom:-200,left:-200,right:200},pos:{x:0,y:0,z:0,set:n},rot:{x:0,y:0,z:0,set:n},target:{x:0,y:0,z:0,set:n}}));_get(Object.getPrototypeOf(t.prototype),"setParams",o).call(o,e);var s=Object.assign(o,{_type:r,_light:o.__params.light,_shadowmap:o.__params.shadowmap});return WHS.debug&&console.debug("@WHS.Light: Light "+s._type+" found.",s),a=s,_possibleConstructorReturn(o,a)}return _inherits(t,e),_createClass(t,[{key:"wrap",value:function(){for(var e=arguments.length,t=Array(e),r=0;e>r;r++)t[r]=arguments[r];var a=this;return new Promise(function(e,r){try{t.indexOf("noshadows")<0&&(a.getNative().castShadow=!0,a.getNative().receiveShadow=!0),a.position.set(a.__params.pos.x,a.__params.pos.y,a.__params.pos.z),a.rotation.set(a.__params.rot.x,a.__params.rot.y,a.__params.rot.z),t.forEach(function(e){a[e]=!0}),WHS.debug&&console.debug("@WHS.Light: Light "+a._type+" is ready.",a),a.emit("ready"),e(a)}catch(n){console.error(n.message),r()}})}},{key:"addTo",value:function(e){this.parent=e;var t=this.helper,r=this;return new Promise(function(e,a){try{r.parent.getScene().add(r.getNative()),r.parent.children.push(r),t&&r.parent.getScene().add(t)}catch(n){console.error(n.message),a()}finally{WHS.debug&&console.debug("@WHS.Camera: Camera "+r._type+" was added to world.",[r,r.parent]),e(r),r.emit("ready")}})}},{key:"wrapShadow",value:function(){var e=this,t=this;return new Promise(function(r,a){try{t.getNative().shadow.mapSize.width=e._shadowmap.width,t.getNative().shadow.mapSize.height=e._shadowmap.height,t.getNative().shadow.bias=e._shadowmap.bias,t.getNative().shadow.camera.near=e._shadowmap.near,t.getNative().shadow.camera.far=e._shadowmap.far,t.getNative().shadow.camera.fov=e._shadowmap.fov,t.getNative().shadow.camera.Left=e._shadowmap.left,t.getNative().shadow.camera.right=e._shadowmap.right,t.getNative().shadow.camera.top=e._shadowmap.top,t.getNative().shadow.camera.bottom=e._shadowmap.bottom}catch(n){console.error(n.message),a()}finally{r(t)}})}},{key:"clone",value:function(){return new WHS.Light(this.__params,this._type).copy(this)}},{key:"copy",value:function(e){return this.light=e.getNative().clone(),e.helper&&(this.helper=e.helper.clone()),this.wrap(),this.position=e.position.clone(),this.rotation=e.rotation.clone(),this._type=e._type,this}},{key:"remove",value:function(){return this.parent.getScene().remove(this.getNative()),source.helper&&this.parent.getScene().remove(this.helper),this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent=null,this.emit("remove"),this}},{key:"setNative",value:function(e){return native.set(this,e)}},{key:"getNative",value:function(){return native.get(this)}},{key:"position",get:function(){return this.getNative().position},set:function(e){return this.getNative().position.copy(e)}},{key:"rotation",get:function(){return this.getNative().rotation},set:function(e){return this.getNative().rotation.copy(e)}},{key:"target",get:function(){return this.getNative().target.position},set:function(e){return this.getNative().target.position.copy(e)}}]),t}(WHS.Object),WHS.Shape=function(e){function t(e,r){var a;_classCallCheck(this,t),r||console.error('@constructor: Please specify " type ".');var n=function(e,t,r){this.x=e,this.y=t,this.z=r},o=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,{mass:10,helpers:{box:!1,boundingBox:!1,edges:!1,faceNormals:!1},pos:{x:0,y:0,z:0,set:n},rot:{x:0,y:0,z:0,set:n},scale:{x:1,y:1,z:1,set:n},target:{x:0,y:0,z:0,set:n},morph:{speed:1,duration:1},physics:!0}));_get(Object.getPrototypeOf(t.prototype),"setParams",o).call(o,e);var s=Object.assign(o,{_type:r,__params:e,wait:[],helpers:{box:!1},physics:e.physics});return WHS.debug&&console.debug("@WHS.Shape: Shape "+s._type+" found.",s),a=s,_possibleConstructorReturn(o,a)}return _inherits(t,e),_createClass(t,[{key:"wait",value:function(e){return this.wait.push(e),this}},{key:"wrap",value:function(){for(var e=this,t=arguments.length,r=Array(t),a=0;t>a;a++)r[a]=arguments[a];return r.indexOf("wait")>=0?new Promise(function(t,r){Promise.all(e.wait).then(function(){try{e.getNative().castShadow=!0,e.getNative().receiveShadow=!0,e.position.set(e.__params.pos.x,e.__params.pos.y,e.__params.pos.z),e.rotation.set(e.__params.rot.x,e.__params.rot.y,e.__params.rot.z),e.scale.set(e.__params.scale.x,e.__params.scale.y,e.__params.scale.z),e.__params.helpers.box&&(e.helpers.box=new THREE.BoxHelper(e.getNative())),e.__params.helpers.boundingBox&&(e.helpers.boundingBox=new THREE.BoundingBoxHelper(e.getNative(),e.__params.helpers.boundingBox.color?e.__params.helpers.boundingBox.color:16777215)),e.__params.helpers.edges&&(e.helpers.edges=new THREE.EdgesHelper(e.getNative(),e.__params.helpers.edges.color?e.__params.helpers.edges.color:16777215)),e.__params.helpers.faceNormals&&(e.helpers.faceNormals=new THREE.FaceNormalsHelper(e.getNative(),e.__params.helpers.faceNormals.size?e.__params.helpers.faceNormals.size:2,e.__params.helpers.faceNormals.color?e.__params.helpers.faceNormals.color:16777215,e.__params.helpers.faceNormals.linewidth?e.__params.helpers.faceNormals.linewidth:1)),e.__params.helpers.vertexNormals&&(e.helpers.vertexNormals=new THREE.VertexNormalsHelper(e.getNative(),e.__params.helpers.vertexNormals.size?e.__params.helpers.vertexNormals.size:2,e.__params.helpers.vertexNormals.color?e.__params.helpers.vertexNormals.color:16777215,e.__params.helpers.vertexNormals.linewidth?e.__params.helpers.vertexNormals.linewidth:1)),WHS.debug&&console.debug("@WHS.Shape: Shape "+e._type+" is ready.",e),e.emit("ready"),t()}catch(a){console.error(a.message),r()}})}):new Promise(function(t,r){try{e.getNative().castShadow=!0,e.getNative().receiveShadow=!0,e.position.set(e.__params.pos.x,e.__params.pos.y,e.__params.pos.z),e.rotation.set(e.__params.rot.x,e.__params.rot.y,e.__params.rot.z),e.scale.set(e.__params.scale.x,e.__params.scale.y,e.__params.scale.z),e.__params.helpers.box&&(e.helpers.box=new THREE.BoxHelper(e.getNative())),e.__params.helpers.boundingBox&&(e.helpers.boundingBox=new THREE.BoundingBoxHelper(e.getNative(),e.__params.helpers.boundingBox.color?e.__params.helpers.boundingBox.color:16777215)),e.__params.helpers.edges&&(e.helpers.edges=new THREE.EdgesHelper(e.getNative(),e.__params.helpers.edges.color?e.__params.helpers.edges.color:16777215)),e.__params.helpers.faceNormals&&(e.helpers.faceNormals=new THREE.FaceNormalsHelper(e.getNative(),e.__params.helpers.faceNormals.size?e.__params.helpers.faceNormals.size:2,e.__params.helpers.faceNormals.color?e.__params.helpers.faceNormals.color:16777215,e.__params.helpers.faceNormals.linewidth?e.__params.helpers.faceNormals.linewidth:1)),e.__params.helpers.vertexNormals&&(e.helpers.vertexNormals=new THREE.VertexNormalsHelper(e.getNative(),e.__params.helpers.vertexNormals.size?e.__params.helpers.vertexNormals.size:2,e.__params.helpers.vertexNormals.color?e.__params.helpers.vertexNormals.color:16777215,e.__params.helpers.vertexNormals.linewidth?e.__params.helpers.vertexNormals.linewidth:1)),WHS.debug&&console.debug("@WHS.Shape: Shape "+e._type+" is ready.",e),t(),e.emit("ready")}catch(a){console.error(a.message),r()}})}},{key:"addTo",value:function(e){this.parent=e;for(var t=this.helpers,r=this,a=arguments.length,n=Array(a>1?a-1:0),o=1;a>o;o++)n[o-1]=arguments[o];return n.indexOf("wait")>=0?new Promise(function(e,a){Promise.all(r.wait).then(function(){try{r.parent.getScene().add(r.getNative()),r.parent.children.push(r),r.__params.helpers.box&&r.parent.getScene().add(t.box),r.__params.helpers.boundingBox&&r.parent.getScene().add(t.boundingBox),r.__params.helpers.edges&&r.parent.getScene().add(t.edges),r.__params.helpers.faceNormals&&r.parent.getScene().add(t.faceNormals),r.__params.helpers.vertexNormals&&r.parent.getScene().add(t.vertexNormals)}catch(n){console.error(n.message),a()}finally{r._wait?r.getNative().addEventListener("ready",function(){e(r)}):e(r),r.getNative().addEventListener("collide",function(){r.emit("collide")}),WHS.debug&&console.debug("@WHS.Shape: Shape "+r._type+" was added to world.",[r,r.parent])}})}):new Promise(function(e,a){try{r.parent.getScene().add(r.getNative()),r.parent.children.push(r),r.__params.helpers.box&&r.parent.getScene().add(t.box),r.__params.helpers.boundingBox&&r.parent.getScene().add(t.boundingBox),r.__params.helpers.edges&&r.parent.getScene().add(t.edges),r.__params.helpers.faceNormals&&r.parent.getScene().add(t.faceNormals),r.__params.helpers.vertexNormals&&r.parent.getScene().add(t.vertexNormals)}catch(n){console.error(n.message),a()}finally{r._wait?r.getNative().addEventListener("ready",function(){e(r)}):e(r),r.getNative().addEventListener("collide",function(){r.emit("ready")}),WHS.debug&&console.debug("@WHS.Shape: Shape "+r._type+" was added to world",[r,r.parent])}})}},{key:"_initMaterial",value:function(e){return this.physics?WHS.API.loadMaterial(e)._material:WHS.API.loadMaterial(e)._materialP}},{key:"clone",value:function(){return new WHS.Shape(this.__params,this._type).copy(this)}},{key:"copy",value:function(e){return this.setNative(e.getNative().clone()),this.wrap(),this.position=e.position.clone(),this.rotation=e.rotation.clone(),this._type=e._type,this}},{key:"remove",value:function(){return this.parent.getScene().remove(this.getNative()),this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent=null,this.emit("remove"),WHS.debug&&console.debug("@WHS.Shape: Shape "+this._type+" was removed from world",[_scope]),this}},{key:"setNative",value:function(e){return native.set(this,e)}},{key:"getNative",value:function(){return native.get(this)}},{key:"follow",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?1e3:arguments[1],r=arguments[2],a=this,n=t,o=new WHS.loop(function(t){var r=1e3*t.getElapsedTime()/n,o=e.getPoint(r%1),s=e.getPoint((r+.01)%1);a.position.set(o.x,o.y,o.z),a.getNative().lookAt(s)});o.start(),r?setInterval(function(){o.stop(),o=new WHS.loop(function(t){var r=1e3*t.getElapsedTime()/n,o=e.getPoint(r%1),s=e.getPoint((r+.01)%1);a.position.set(o.x,o.y,o.z),a.getNative().lookAt(s)}),o.start()},t):setTimeout(function(){o.stop()},t)}},{key:"position",get:function(){return this.getNative().__dirtyPosition=!0,this.getNative().position},set:function(e){return this.getNative().__dirtyPosition=!0,this.getNative().position.copy(e)}},{key:"rotation",get:function(){return this.getNative().__dirtyRotation=!0,this.getNative().rotation},set:function(e){return this.getNative().__dirtyRotation=!0,this.getNative().rotation.copy(e)}},{key:"scale",get:function(){return this.getNative().scale},set:function(e){return this.getNative().scale=e}}]),t}(WHS.Object),WHS.World=function(e){function t(){var e,r=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,t),THREE||console.warn("WhitestormJS requires Three.js. {Object} THREE is undefined."),Physijs||console.warn("WhitestormJS requires Physi.js. {Object} Physijs is undefined.");var a=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,{stats:!1,autoresize:!1,shadowmap:{enabled:!0,type:THREE.PCFSoftShadowMap},helpers:{grid:!1,axis:!1},gravity:{x:0,y:0,z:0},camera:{aspect:75,near:1,far:1e3,x:0,y:0,z:0},rWidth:1,rHeight:1,width:window.innerWidth,height:window.innerHeight,physics:{quatNormalizeSkip:0,quatNormalizeFast:!1,solver:{iterations:20,tolerance:0},defMaterial:{contactEquationStiffness:1e8,contactEquationRegularizationTime:3}},background:0,assets:"./assets",container:document.body,path_worker:"../libs/physijs_worker.js",path_ammo:"../libs/ammo.js"}));_get(Object.getPrototypeOf(t.prototype),"setParams",a).call(a,r),native.set(a,{}),a._initScene(),a._initDOM(),a._initStats(),a._initCamera(),a._initRenderer(),a._initHelpers();var n=a;return a.__params.autoresize&&window.addEventListener("resize",function(){n.setSize(window.innerWidth,window.innerHeight)}),e=n,_possibleConstructorReturn(a,e)}return _inherits(t,e),_createClass(t,[{key:"_initScene",value:function(){this._initPhysiJS();var e=new Physijs.Scene;e.setGravity(new THREE.Vector3(this.__params.gravity.x,this.__params.gravity.y,this.__params.gravity.z)),
this.setScene(e),this.children=[]}},{key:"_initPhysiJS",value:function(){this.simulate=!0,Physijs.scripts.worker=this.__params.path_worker,Physijs.scripts.ammo=this.__params.path_ammo}},{key:"_initDOM",value:function(){return this.__params.container.style.margin=0,this.__params.container.style.padding=0,this.__params.container.style.position="relative",this.__params.container.style.overflow="hidden",this._dom=document.createElement("div"),this._dom.className="whs",this.__params.container.appendChild(this._dom),this._dom}},{key:"_initStats",value:function(){this.__params.stats&&(this._stats=new Stats,"fps"==this.__params.stats?this._stats.setMode(0):"ms"==this.__params.stats?this._stats.setMode(1):"mb"==this.__params.stats?this._stats.setMode(1):(this._stats.setMode(0),console.warn([this._stats],"Please, apply stats mode [fps, ms, mb] .")),this._stats.domElement.style.position="absolute",this._stats.domElement.style.left="0px",this._stats.domElement.style.bottom="0px",this._dom.appendChild(this._stats.domElement))}},{key:"_initCamera",value:function(){this.setCamera(new WHS.PerspectiveCamera({camera:{fov:this.__params.camera.aspect,aspect:this.__params.width/this.__params.height,near:this.__params.camera.near,far:this.__params.camera.far},pos:{x:this.__params.camera.x,y:this.__params.camera.y,z:this.__params.camera.z}})),this.getCamera().addTo(this)}},{key:"_initRenderer",value:function(){this.render=!0,this.setRenderer(new THREE.WebGLRenderer),this.getRenderer().setClearColor(this.__params.background),this.getRenderer().shadowMap.enabled=this.__params.shadowmap.enabled,this.getRenderer().shadowMap.type=this.__params.shadowmap.type,this.getRenderer().shadowMap.cascade=!0,this.getRenderer().setSize(+(this.__params.width*this.__params.rWidth).toFixed(),+(this.__params.height*this.__params.rHeight).toFixed()),this.getRenderer().render(this.getScene(),this.getCamera().getNative()),this._dom.appendChild(this.getRenderer().domElement),this.getRenderer().domElement.style.width="100%",this.getRenderer().domElement.style.height="100%"}},{key:"_initHelpers",value:function(){this.__params.helpers.axis&&this.getScene().add(new THREE.AxisHelper(this.__params.helpers.axis.size?this.__params.helpers.axis.size:5)),this.__params.helpers.grid&&this.getScene().add(new THREE.GridHelper(this.__params.helpers.grid.size?this.__params.helpers.grid.size:10,this.__params.helpers.grid.step?this.__params.helpers.grid.step:1))}},{key:"start",value:function(){function e(a){requestAnimationFrame(e),r._stats&&r._stats.begin(),r.__localTime=a,r._process(t),r.simulate&&r.getScene().simulate(),r._updateControls(),r._composer?(r._composer.reset(),r.render&&r._composer.render(r.getScene(),r.getCamera().getNative()),r._composer.pass(r._composer.stack),r._composer.toScreen()):r.render&&r.getRenderer().render(r.getScene(),r.getCamera().getNative()),r._execLoops(a),r._stats&&r._stats.end()}var t=new THREE.Clock,r=this;this._update=e,r._update()}},{key:"_execLoops",value:function(e){WHS.loops.forEach(function(t){t.enabled&&t.func(t.clock,e)})}},{key:"_updateControls",value:function(){this.controls&&(this.controls.update(Date.now()-this.time),this.time=Date.now())}},{key:"_process",value:function(e){for(var t=e.getDelta(),r=0;r<this.children.length;r++)"morph"==this.children[r]._type&&this.children[r].getNative().mixer.update(t)}},{key:"setSize",value:function(){var e=arguments.length<=0||void 0===arguments[0]?1:arguments[0],t=arguments.length<=1||void 0===arguments[1]?1:arguments[1];this.getCamera().getNative().aspect=e/t,this.getCamera().getNative().updateProjectionMatrix(),this.getRenderer().setSize(+(e*this.__params.rWidth).toFixed(),+(t*this.__params.rHeight).toFixed())}},{key:"setScene",value:function(e){return native.get(this).scene=e}},{key:"getScene",value:function(){return native.get(this).scene}},{key:"setRenderer",value:function(e){return native.get(this).renderer=e}},{key:"getRenderer",value:function(){return native.get(this).renderer}},{key:"setCamera",value:function(e){return e instanceof WHS.Camera?native.get(this).camera=e:console.error("@WHS.World: camera in not an instance of WHS.Camera."),this}},{key:"getCamera",value:function(){return native.get(this).camera}}]),t}(WHS.Object),WHS.API.extend=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),a=1;t>a;a++)r[a-1]=arguments[a];var n=!0,o=!1,s=void 0;try{for(var i,l=r[Symbol.iterator]();!(n=(i=l.next()).done);n=!0){var c=i.value;if(c){var u=!0,h=!1,p=void 0;try{for(var m,d=Object.getOwnPropertyNames(c)[Symbol.iterator]();!(u=(m=d.next()).done);u=!0){var g=m.value;void 0!=e[g]&&"[object Object]"==e[g].toString()&&"[object Object]"==c[g].toString()?WHS.API.extend(e[g],c[g]):e[g]=0===e[g]?0:e[g],"undefined"==typeof e[g]&&(e[g]=c[g])}}catch(y){h=!0,p=y}finally{try{!u&&d["return"]&&d["return"]()}finally{if(h)throw p}}}}}catch(y){o=!0,s=y}finally{try{!n&&l["return"]&&l["return"]()}finally{if(o)throw s}}return e},WHS.API.loadMaterial=function(e){var t=arguments.length<=1||void 0===arguments[1]?!0:arguments[1];"string"!=typeof e.kind&&console.error("Type of material is undefined or not a string. @loadMaterial");var r={_type:e.kind,_restitution:isNaN(parseFloat(e.restitution))?isNaN(parseFloat(e.rest))?.3:e.rest:e.restitution,_friction:isNaN(parseFloat(e.friction))?isNaN(parseFloat(e.fri))?.8:e.fri:e.friction},a=WHS.API.extend({},e);switch(delete a.kind,delete a.friction,delete a.fri,delete a.restitution,delete a.rest,delete a.useCustomMaterial,delete a.useVertexColors,e.kind){case"basic":r._material=new THREE.MeshBasicMaterial(a);break;case"linebasic":r._material=new THREE.LineBasicMaterial(a);break;case"linedashed":r._material=new THREE.LineDashedMaterial(a);break;case"material":r._material=new THREE.Material(a);break;case"depth":r._material=new THREE.MeshDepthMaterial(a);break;case"face":r._material=new THREE.MeshFaceMaterial(a);break;case"lambert":r._material=new THREE.MeshLambertMaterial(a);break;case"normal":r._material=new THREE.MeshNormalMaterial(a);break;case"phong":r._material=new THREE.MeshPhongMaterial(a);break;case"pointcloud":r._material=new THREE.PointCloudMaterial(a);break;case"rawshader":r._material=new THREE.RawShaderMaterial(a);break;case"shader":r._material=new THREE.ShaderMaterial(a);break;case"spritecanvas":r._material=new THREE.SpriteCanvasMaterial(a);break;case"sprite":r._material=new THREE.SpriteMaterial(a)}return t&&(r._materialP=Physijs.createMaterial(r._material,r._friction,r._restitution)),r},WHS.API.merge=function(e,t){if(("object"!==("undefined"==typeof e?"undefined":_typeof(e))||"object"!==("undefined"==typeof t?"undefined":_typeof(t)))&&console.error("No rabbits for the box. (arguments)",["undefined"==typeof e?"undefined":_typeof(e),"undefined"==typeof t?"undefined":_typeof(t)]),e)if(Array.isArray(t)&&1===t.length)e.add(t[0]);else if(Array.isArray(t)&&t.length>1&&e)for(var r=0;r<t.length;r++)e.add(t[r]);else Array.isArray(t)||e.add(t);else console.error("box is undefined. Line "+(new Error).lineNumber+". Func merge.",[e,t])},WHS.API.texture=function(e,t){var r=WHS.API.loadTexture(e);if(t){var a=WHS.API.extend(t,{offset:{x:0,y:0},repeat:{x:1,y:1}});r.wrapS=r.wrapT=THREE.RepeatWrapping,r.offset.set(a.offset.x,a.offset.y),r.repeat.set(a.repeat.x,a.repeat.y),r.magFilter=THREE.NearestFilter,r.minFilter=THREE.LinearMipMapLinearFilter}return r},WHS.Watch=function(e){return this._queue=Array.isArray(e)?e.slice():[],this},WHS.Watch.prototype.add=function(e){return this._queue.push(e),this},WHS.Watch.prototype.remove=function(e){return this._queue=this._queue.filter(function(t){return t!=e}),this},WHS.loop=function(e){this.loop={func:e,id:WHS.loops.length,clock:new THREE.Clock,enabled:!1},WHS.loops.push(this.loop)},WHS.loop.prototype.start=function(){this.loop.clock.start(),this.loop.enabled=!0},WHS.loop.prototype.stop=function(){this.loop.clock.stop(),this.loop.enabled=!1},WHS.loop.prototype.remove=function(){var e=this;this.loop.clock.stop(),this.loop.enabled=!1,WHS.loops.filter(function(t){return t!==e.loop})},WHS.Box=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"box"));return WHS.API.extend(e.geometry,{width:1,height:1,depth:1}),r.build(e),_get(Object.getPrototypeOf(t.prototype),"wrap",r).call(r),r}return _inherits(t,e),_createClass(t,[{key:"build",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=this,a=this.physics?Physijs.BoxMesh:THREE.Mesh,n=_get(Object.getPrototypeOf(t.prototype),"_initMaterial",this).call(this,e.material);return new Promise(function(t,o){r.setNative(new a(new THREE.BoxGeometry(e.geometry.width,e.geometry.height,e.geometry.depth),n,e.mass)),t()})}}]),t}(WHS.Shape),WHS.World.prototype.Box=function(e){var t=new WHS.Box(e);return t.addTo(this),t},WHS.Cylinder=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"cylinder"));return WHS.API.extend(e.geometry,{radiusTop:1,radiusBottom:1,height:1,radiusSegments:32}),r.build(e),_get(Object.getPrototypeOf(t.prototype),"wrap",r).call(r),r}return _inherits(t,e),_createClass(t,[{key:"build",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=this,a=this.physics?Physijs.CylinderMesh:THREE.Mesh,n=_get(Object.getPrototypeOf(t.prototype),"_initMaterial",this).call(this,e.material);return new Promise(function(t,o){r.setNative(new a(new THREE.CylinderGeometry(e.geometry.radiusTop,e.geometry.radiusBottom,e.geometry.height,e.geometry.radiusSegments),n,e.mass)),t()})}}]),t}(WHS.Shape),WHS.World.prototype.Cylinder=function(e){var t=new WHS.Cylinder(e);return t.addTo(this),t},WHS.Dodecahedron=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"dodecahedron"));return WHS.API.extend(e.geometry,{radius:1,detail:0}),r.build(e),_get(Object.getPrototypeOf(t.prototype),"wrap",r).call(r),r}return _inherits(t,e),_createClass(t,[{key:"build",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=this,a=this.physics?Physijs.ConvexMesh:THREE.Mesh,n=_get(Object.getPrototypeOf(t.prototype),"_initMaterial",this).call(this,e.material);return new Promise(function(t,o){r.setNative(new a(new THREE.DodecahedronGeometry(e.geometry.radius,e.geometry.detail),n,e.mass)),t()})}}]),t}(WHS.Shape),WHS.World.prototype.Dodecahedron=function(e){var t=new WHS.Dodecahedron(e);return t.addTo(this),t},WHS.Extrude=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"extrude"));return WHS.API.extend(e.geometry,{shapes:[],options:{}}),r.build(e),_get(Object.getPrototypeOf(t.prototype),"wrap",r).call(r),r}return _inherits(t,e),_createClass(t,[{key:"build",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=this,a=this.physics?Physijs.ConvexMesh:THREE.Mesh,n=_get(Object.getPrototypeOf(t.prototype),"_initMaterial",this).call(this,e.material);return new Promise(function(t,o){r.setNative(new a(new THREE.ExtrudeGeometry(e.geometry.shapes,e.geometry.options),n,e.mass)),t()})}}]),t}(WHS.Shape),WHS.World.prototype.Extrude=function(e){var t=new WHS.Extrude(e);return t.addTo(this),t},WHS.Icosahderon=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"icosahedron"));return WHS.API.extend(e.geometry,{radius:1,detail:0}),r.build(e),_get(Object.getPrototypeOf(t.prototype),"wrap",r).call(r),r}return _inherits(t,e),_createClass(t,[{key:"build",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=this,a=this.physics?Physijs.ConvexMesh:THREE.Mesh,n=_get(Object.getPrototypeOf(t.prototype),"_initMaterial",this).call(this,e.material);return new Promise(function(t,o){r.setNative(new a(new THREE.IcosahedronGeometry(e.geometry.radius,e.geometry.detail),n,e.mass)),t()})}}]),t}(WHS.Shape),WHS.World.prototype.Icosahedron=function(e){var t=new WHS.Icosahderon(e);return t.addTo(this),t},WHS.Lathe=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"lathe"));return WHS.API.extend(e.geometry,{points:[]}),r.build(e),_get(Object.getPrototypeOf(t.prototype),"wrap",r).call(r),r}return _inherits(t,e),_createClass(t,[{key:"build",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=this,a=this.physics?Physijs.ConvexMesh:THREE.Mesh,n=_get(Object.getPrototypeOf(t.prototype),"_initMaterial",this).call(this,e.material);return new Promise(function(t,o){r.setNative(new a(new THREE.LatheGeometry(e.geometry.points),n,e.mass)),t()})}}]),t}(WHS.Shape),WHS.World.prototype.Lathe=function(e){var t=new WHS.Lathe(e);return t.addTo(this),t},WHS.Model=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"model"));WHS.API.extend(e.geometry,{path:"",physics:""});return r.build(e),_get(Object.getPrototypeOf(t.prototype),"wrap",r).call(r,"wait"),r}return _inherits(t,e),_createClass(t,[{key:"build",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=this,a=this.physics?Physijs.ConcaveMesh:THREE.Mesh,n=new Promise(function(t,n){WHS.API.loadJSON(e.geometry.path,function(n,o){if(""!=e.geometry.physics)WHS.API.loadJSON(e.geometry.physics,function(s){if(e.material.useVertexColors)var i=WHS.API.loadMaterial(WHS.API.extend(e.material,{morphTargets:!0,vertexColors:THREE.FaceColors}))._material;else if(!o||e.material.useCustomMaterial)var i=WHS.API.loadMaterial(e.material)._material;else var i=new THREE.MultiMaterial(o);console.log(n),n.computeFaceNormals(),n.computeVertexNormals(),r.setNative(new a(n,i,e.mass,s,e.scale)),t()});else{if(!o||e.material.useVertexColors)var s=WHS.API.loadMaterial(WHS.API.extend(e.material,{morphTargets:!0,vertexColors:THREE.FaceColors}))._material;else if(e.material.useCustomMaterial)var s=WHS.API.loadMaterial(e.material)._material;else var s=new THREE.MultiMaterial(o);n.computeFaceNormals(),n.computeVertexNormals(),r.setNative(new a(n,s,e.mass)),t()}})});return _get(Object.getPrototypeOf(t.prototype),"wait",this).call(this,n),n}}]),t}(WHS.Shape),WHS.World.prototype.Model=function(e){var t=new WHS.Model(e);return t.addTo(this,"wait"),t},WHS.Morph=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"morph"));WHS.API.extend(e.geometry,{path:""});return r.build(e),_get(Object.getPrototypeOf(t.prototype),"wrap",r).call(r,"wait"),r}return _inherits(t,e),_createClass(t,[{key:"build",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=this,a=new Promise(function(t,a){WHS.API.loadJSON(e.geometry.path,function(a,n){if(e.material.useVertexColors)var o=WHS.API.loadMaterial(WHS.API.extend(e.material,{morphTargets:!0,vertexColors:THREE.FaceColors}))._material;else if(!n||e.material.useCustomMaterial)var o=WHS.API.loadMaterial(e.material)._material;else var o=new THREE.MultiMaterial(n);a.computeFaceNormals(),a.computeVertexNormals();var s=new THREE.Mesh(a,o);s.speed=e.morph.speed,s.mixer=new THREE.AnimationMixer(s),s.mixer.clipAction(a.animations[0]).setDuration(e.morph.duration).play(),r.setNative(s),t()})});return _get(Object.getPrototypeOf(t.prototype),"wait",this).call(this,a),a}}]),t}(WHS.Shape),WHS.World.prototype.Morph=function(e){var t=new WHS.Morph(e);return t.addTo(this,"wait"),t},WHS.Octahedron=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"octahedron"));return WHS.API.extend(e.geometry,{radius:1,detail:0}),r.build(e),_get(Object.getPrototypeOf(t.prototype),"wrap",r).call(r),r}return _inherits(t,e),_createClass(t,[{key:"build",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=this,a=this.physics?Physijs.ConvexMesh:THREE.Mesh,n=_get(Object.getPrototypeOf(t.prototype),"_initMaterial",this).call(this,e.material);return new Promise(function(t,o){r.setNative(new a(new THREE.OctahedronGeometry(e.geometry.radius,e.geometry.detail),n,e.mass)),t()})}}]),t}(WHS.Shape),WHS.World.prototype.Octahedron=function(e){var t=new WHS.Octahedron(e);return t.addTo(this),t},WHS.Parametric=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"parametric"));return WHS.API.extend(e.geometry,{func:function(){},slices:10,stacks:10}),r.build(e),_get(Object.getPrototypeOf(t.prototype),"wrap",r).call(r),r}return _inherits(t,e),_createClass(t,[{key:"build",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=this,a=this.physics?Physijs.ConcaveMesh:THREE.Mesh,n=_get(Object.getPrototypeOf(t.prototype),"_initMaterial",this).call(this,e.material);return new Promise(function(t,o){r.setNative(new a(new THREE.ParametricGeometry(e.geometry.func,e.geometry.slices,e.geometry.stacks),n,e.mass)),t()})}}]),t}(WHS.Shape),WHS.World.prototype.Parametric=function(e){var t=new WHS.Parametric(e);return t.addTo(this),t},WHS.Plane=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"plane"));return WHS.API.extend(e.geometry,{width:10,height:10,segments:32}),r.build(e),_get(Object.getPrototypeOf(t.prototype),"wrap",r).call(r),r}return _inherits(t,e),_createClass(t,[{key:"build",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=this,a=this.physics?Physijs.PlaneMesh:THREE.Mesh,n=_get(Object.getPrototypeOf(t.prototype),"_initMaterial",this).call(this,e.material);return new Promise(function(t,o){r.setNative(new a(new THREE.PlaneGeometry(e.geometry.width,e.geometry.height,e.geometry.segments),n,e.mass)),t()})}}]),t}(WHS.Shape),WHS.World.prototype.Plane=function(e){var t=new WHS.Plane(e);return t.addTo(this),t},WHS.Polyhedron=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"polyhedron"));return WHS.API.extend(e.geometry,{verticesOfCube:r.verticesOfCube,indicesOfFaces:r.indicesOfFaces,radius:6,detail:2}),r.build(e),_get(Object.getPrototypeOf(t.prototype),"wrap",r).call(r),r}return _inherits(t,e),_createClass(t,[{key:"build",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=this,a=this.physics?Physijs.ConvexMesh:THREE.Mesh,n=_get(Object.getPrototypeOf(t.prototype),"_initMaterial",this).call(this,e.material);return new Promise(function(t,o){r.setNative(new a(new THREE.PolyhedronGeometry(e.geometry.verticesOfCube,e.geometry.indicesOfFaces,e.geometry.radius,e.geometry.detail),n,e.mass)),t()})}},{key:"verticesOfCube",get:function(){return[-1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1,1,1,-1,1,1,1,1,-1,1,1]}},{key:"indicesOfFaces",get:function(){return[2,1,0,0,3,2,0,4,7,7,3,0,0,1,5,5,4,0,1,2,6,6,5,1,2,3,7,7,6,2,4,5,6,6,7,4]}}]),t}(WHS.Shape),WHS.World.prototype.Polyhedron=function(e){var t=new WHS.Polyhedron(e);return t.addTo(this),t},WHS.Ring=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"ring"));return WHS.API.extend(e.geometry,{innerRadius:0,outerRadius:50,thetaSegments:8,phiSegments:8,thetaStart:0,thetaLength:2*Math.PI}),r.build(e),_get(Object.getPrototypeOf(t.prototype),"wrap",r).call(r,"onlyvis"),r}return _inherits(t,e),_createClass(t,[{key:"build",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=this,a=_get(Object.getPrototypeOf(t.prototype),"_initMaterial",this).call(this,e.material);return new Promise(function(t,n){r.setNative(new THREE.Mesh(new THREE.RingGeometry(e.geometry.innerRadius,e.geometry.outerRadius,e.geometry.thetaSegments,e.geometry.phiSegments,e.geometry.thetaStart,e.geometry.thetaLength),a)),t()})}}]),t}(WHS.Shape),WHS.World.prototype.Ring=function(e){var t=new WHS.Ring(e);return t.addTo(this),t},WHS.Shape2D=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"shape2D"));return WHS.API.extend(e.geometry,{shapes:[]}),_get(Object.getPrototypeOf(t.prototype),"build",r).call(r,e),_get(Object.getPrototypeOf(t.prototype),"wrap",r).call(r,"onlyvis"),r}return _inherits(t,e),_createClass(t,[{key:"build",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=this,a=_get(Object.getPrototypeOf(t.prototype),"_initMaterial",this).call(this,e.material);return new Promise(function(t,n){r.setNative(new THREE.Mesh(new THREE.ShapeGeometry(e.geometry.shapes),a)),t()})}}]),t}(WHS.Shape),WHS.World.prototype.Shape2D=function(e){var t=new WHS.Shape2D(e);return t.addTo(this),t},WHS.Sphere=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"sphere"));return WHS.API.extend(e.geometry,{radius:1,segmentA:32,segmentB:32}),r.build(e),_get(Object.getPrototypeOf(t.prototype),"wrap",r).call(r),r}return _inherits(t,e),_createClass(t,[{key:"build",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=this,a=this.physics?Physijs.SphereMesh:THREE.Mesh,n=_get(Object.getPrototypeOf(t.prototype),"_initMaterial",this).call(this,e.material);return new Promise(function(t,o){r.setNative(new a(new THREE.SphereGeometry(e.geometry.radius,e.geometry.segmentA,e.geometry.segmentB),n,e.mass)),t()})}}]),t}(WHS.Shape),WHS.World.prototype.Sphere=function(e){var t=new WHS.Sphere(e);return t.addTo(this),t},WHS.Tetrahedron=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"tetrahedron"));return WHS.API.extend(e.geometry,{radius:1,detail:0}),r.build(e),_get(Object.getPrototypeOf(t.prototype),"wrap",r).call(r),r}return _inherits(t,e),_createClass(t,[{key:"build",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=this,a=this.physics?Physijs.ConvexMesh:THREE.Mesh,n=_get(Object.getPrototypeOf(t.prototype),"_initMaterial",this).call(this,e.material);return new Promise(function(t,o){r.setNative(new a(new THREE.TetrahedronGeometry(e.geometry.radius,e.geometry.detail),n,e.mass)),t()})}}]),t}(WHS.Shape),WHS.World.prototype.Tetrahedron=function(e){var t=new WHS.Tetrahedron(e);return t.addTo(this),t},WHS.Text=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"text"));return WHS.API.extend(e.geometry,{text:"Hello World!",parameters:{size:12,height:50,curveSegments:12,font:new THREE.Font,bevelEnabled:!1,bevelThickness:10,bevelSize:8}}),r.build(e),_get(Object.getPrototypeOf(t.prototype),"wrap",r).call(r,"wait"),r}return _inherits(t,e),_createClass(t,[{key:"build",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=this,a=(this.physics?Physijs.ConcaveMesh:THREE.Mesh,_get(Object.getPrototypeOf(t.prototype),"_initMaterial",this).call(this,e.material)),n=new Promise(function(t,n){WHS.API.loadFont(e.geometry.parameters.font,function(n){e.geometry.parameters.font=n;var o=scope.physics?Physijs.ConcaveMesh:THREE.Mesh;r.setNative(new o(new THREE.TextGeometry(e.geometry.text,e.geometry.parameters),a,e.mass)),t()})});return _get(Object.getPrototypeOf(t.prototype),"wait",this).call(this,n),n}}]),t}(WHS.Shape),WHS.World.prototype.Text=function(e){var t=new WHS.Text(e);return t.addTo(this,"wait"),t},WHS.Torus=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"torus"));return WHS.API.extend(e.geometry,{radius:100,tube:40,radialSegments:8,tubularSegments:6,arc:2*Math.PI}),r.build(e),_get(Object.getPrototypeOf(t.prototype),"wrap",r).call(r),r}return _inherits(t,e),_createClass(t,[{key:"build",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=this,a=this.physics?Physijs.ConvexMesh:THREE.Mesh,n=_get(Object.getPrototypeOf(t.prototype),"_initMaterial",this).call(this,e.material);return new Promise(function(t,o){r.setNative(new a(new THREE.TorusGeometry(e.geometry.radius,e.geometry.tube,e.geometry.radialSegments,e.geometry.tubularSegments,e.geometry.arc),n,e.mass)),t()})}}]),t}(WHS.Shape),WHS.World.prototype.Torus=function(e){var t=new WHS.Torus(e);return t.addTo(this),t},WHS.Torusknot=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"Torusknot"));return WHS.API.extend(e.geometry,{radius:100,tube:40,radialSegments:64,tubularSegments:8,p:2,q:3,heightScale:1}),r.build(e),_get(Object.getPrototypeOf(t.prototype),"wrap",r).call(r),r}return _inherits(t,e),_createClass(t,[{key:"build",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=this,a=this.physics?Physijs.ConvexMesh:THREE.Mesh,n=_get(Object.getPrototypeOf(t.prototype),"_initMaterial",this).call(this,e.material);return new Promise(function(t,o){r.setNative(new a(new THREE.TorusKnotGeometry(e.geometry.radius,e.geometry.tube,e.geometry.radialSegments,e.geometry.tubularSegments,e.geometry.p,e.geometry.q,e.geometry.heightScale),n,e.mass)),t()})}}]),t}(WHS.Shape),WHS.World.prototype.Torusknot=function(e){var t=new WHS.Torusknot(e);return t.addTo(this),t},WHS.Tube=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"tube"));return WHS.API.extend(e.geometry,{path:options.geometryOptions.path?new r.CustomSinCurve(100):!1,segments:20,radius:2,radiusSegments:8,closed:!1}),r.build(e),_get(Object.getPrototypeOf(t.prototype),"wrap",r).call(r),r}return _inherits(t,e),_createClass(t,[{key:"build",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=this,a=this.physics?Physijs.ConvexMesh:THREE.Mesh,n=_get(Object.getPrototypeOf(t.prototype),"_initMaterial",this).call(this,e.material);return new Promise(function(t,o){r.setNative(new a(new THREE.TubeGeometry(e.geometry.path,e.geometry.segments,e.geometry.radius,e.geometry.radiusSegments,e.geometry.closed),n,e.mass)),t()})}},{key:"CustomSinCurve",get:function(){return THREE.Curve.create(function(e){this.scale=e||1},function(e){var t=3*e-1.5,r=Math.sin(2*Math.PI*e),a=0;return new THREE.Vector3(t,r,a).multiplyScalar(this.scale)})}}]),t}(WHS.Shape),WHS.World.prototype.Tube=function(e){var t=new WHS.Tube(e);return t.addTo(this),t},WHS.AmbientLight=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"ambientlight"));return r.build(e),_get(Object.getPrototypeOf(t.prototype),"wrap",r).call(r,"noshadows"),r}return _inherits(t,e),_createClass(t,[{key:"build",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=this;return new Promise(function(r,a){t.setNative(new THREE.AmbientLight(e.light.color,e.light.intensity)),r()})}}]),t}(WHS.Light),WHS.World.prototype.AmbientLight=function(e){var t=new WHS.AmbientLight(e);return t.addTo(this),t},WHS.DirectionalLight=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"directionallight"));return r.build(e),_get(Object.getPrototypeOf(t.prototype),"wrap",r).call(r),_get(Object.getPrototypeOf(t.prototype),"wrapShadow",r).call(r),r}return _inherits(t,e),_createClass(t,[{key:"build",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=this;return new Promise(function(r,a){t.setNative(new THREE.DirectionalLight(e.light.color,e.light.intensity)),e.helper&&(t.helper=new THREE.DirectionalLightHelper(t.light,e.helper.size?e.helper.size:0)),r()})}}]),t}(WHS.Light),WHS.World.prototype.DirectionalLight=function(e){var t=new WHS.DirectionalLight(e);return t.addTo(this),t},WHS.HemisphereLight=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"hemispherelight"));return r.build(e),_get(Object.getPrototypeOf(t.prototype),"wrap",r).call(r),_get(Object.getPrototypeOf(t.prototype),"wrapShadow",r).call(r),r}return _inherits(t,e),_createClass(t,[{key:"build",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=this;return new Promise(function(r,a){t.setNative(new THREE.HemisphereLight(e.light.skyColor,e.light.groundColor,e.light.intensity)),e.helper&&(t.helper=new THREE.HemisphereLightHelper(t.light,e.helper.size?e.helper.size:0)),r()})}}]),t}(WHS.Light),WHS.World.prototype.HemisphereLight=function(e){var t=new WHS.HemisphereLight(e);return t.addTo(this),t},WHS.NormalLight=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"normallight"));return r.build(e),_get(Object.getPrototypeOf(t.prototype),"wrap",r).call(r),_get(Object.getPrototypeOf(t.prototype),"wrapShadow",r).call(r),r}return _inherits(t,e),_createClass(t,[{key:"build",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=this;return new Promise(function(r,a){t.setNative(new THREE.Light(e.light.color)),r()})}}]),t}(WHS.Light),WHS.World.prototype.NormalLight=function(e){var t=new WHS.NormalLight(e);return t.addTo(this),t},WHS.PointLight=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"pointlight"));return r.build(e),_get(Object.getPrototypeOf(t.prototype),"wrap",r).call(r),_get(Object.getPrototypeOf(t.prototype),"wrapShadow",r).call(r),r}return _inherits(t,e),_createClass(t,[{key:"build",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=this;return new Promise(function(r,a){t.setNative(new THREE.PointLight(e.light.color,e.light.intensity,e.light.distance,e.light.decay)),e.helper&&(t.helper=new THREE.PointLightHelper(t.light,e.helper.size?e.helper.size:0)),r()})}}]),t}(WHS.Light),WHS.World.prototype.PointLight=function(e){var t=new WHS.PointLight(e);return t.addTo(this),t},WHS.SpotLight=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"spotlight"));return r.build(e),_get(Object.getPrototypeOf(t.prototype),"wrap",r).call(r),_get(Object.getPrototypeOf(t.prototype),"wrapShadow",r).call(r),
r}return _inherits(t,e),_createClass(t,[{key:"build",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=this;return new Promise(function(r,a){t.setNative(new THREE.SpotLight(e.light.color,e.light.intensity,e.light.distance,e.light.angle,e.light.exponent,e.light.decay)),e.helper&&(t.helper=new THREE.SpotLightHelper(t.light)),r()})}}]),t}(WHS.Light),WHS.World.prototype.SpotLight=function(e){var t=new WHS.SpotLight(e);return t.addTo(this),t},WHS.CubeCamera=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"cubecamera"));return r.build(e),_get(Object.getPrototypeOf(t.prototype),"wrap",r).call(r),r}return _inherits(t,e),_createClass(t,[{key:"build",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=this;return new Promise(function(r,a){t.setNative(new THREE.CubeCamera(e.camera.near,e.camera.far,e.camera.cubeResolution)),r()})}}]),t}(WHS.Camera),WHS.World.prototype.CubeCamera=function(e){var t=new WHS.CubeCamera(e);return t.addTo(this),t},WHS.OrtographicCamera=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"ortographiccamera"));return r.build(e),_get(Object.getPrototypeOf(t.prototype),"wrap",r).call(r),r}return _inherits(t,e),_createClass(t,[{key:"build",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=this;return new Promise(function(r,a){t.setNative(new THREE.OrtographicCamera(e.camera.left,e.camera.right,e.camera.top,e.camera.bottom,e.camera.near,e.camera.far)),r()})}}]),t}(WHS.Camera),WHS.World.prototype.OrtographicCamera=function(e){var t=new WHS.OrtographicCamera(e);return t.addTo(this),t},WHS.PerspectiveCamera=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"perspectivecamera"));return r.build(e),_get(Object.getPrototypeOf(t.prototype),"wrap",r).call(r),r}return _inherits(t,e),_createClass(t,[{key:"build",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=this;return new Promise(function(r,a){t.setNative(new THREE.PerspectiveCamera(e.camera.fov,e.camera.aspect,e.camera.near,e.camera.far)),r()})}}]),t}(WHS.Camera),WHS.World.prototype.PerspectiveCamera=function(e){var t=new WHS.PerspectiveCamera(e);return t.addTo(this),t};var PI_2=Math.PI/2;WHS.World.prototype.FPSControls=function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=WHS.API.extend(t,{block:document.getElementById("blocker"),speed:1,ypos:1});this.controls=new function(e,t,r){function a(e){if(l.enabled!==!1){var t=e.movementX||e.mozMovementX||e.getMovementX()||0,r=e.movementY||e.mozMovementY||e.getMovementY()||0;h.rotation.y-=.002*t,u.rotation.x-=.002*r,u.rotation.x=Math.max(-PI_2,Math.min(PI_2,u.rotation.x))}}function n(e){switch(e.keyCode){case 38:case 87:m=!0;break;case 37:case 65:g=!0;break;case 40:case 83:d=!0;break;case 39:case 68:y=!0;break;case 32:1==f&&c.applyCentralImpulse({x:0,y:300,z:0}),f=!1;break;case 16:i=.5}}function o(e){switch(e.keyCode){case 38:case 87:m=!1;break;case 37:case 65:g=!1;break;case 40:case 83:d=!1;break;case 39:case 68:y=!1;break;case 16:i=.25}}var s=1,i=.25;t.setAngularFactor({x:0,y:0,z:0});var l=this,c=t,u=new THREE.Object3D;u.add(e.getNative());var h=new THREE.Object3D;h.position.y=r.ypos,h.add(u);var p=new THREE.Quaternion,m=!1,d=!1,g=!1,y=!1,f=!1;c.addEventListener("collision",function(e,t,r,a){a.y<.5&&(f=!0)}),document.body.addEventListener("mousemove",a,!1),document.body.addEventListener("keydown",n,!1),document.body.addEventListener("keyup",o,!1),this.enabled=!1,this.getObject=function(){return h},this.getDirection=function(e){e.set(0,0,-1),p.multiplyVector3(e)};var v=new THREE.Vector3,_=new THREE.Euler;this.update=function(e){new THREE.Vector3;if(l.enabled!==!1){e=e||.5,e=Math.min(e,.5),v.set(0,0,0);var t=s*e*r.speed*i;m&&(v.z=-t),d&&(v.z=t),g&&(v.x=-t),y&&(v.x=t),_.x=u.rotation.x,_.y=h.rotation.y,_.order="XYZ",p.setFromEuler(_),v.applyQuaternion(p),c.applyCentralImpulse({x:10*v.x,y:0,z:10*v.z}),c.setAngularVelocity({x:10*v.z,y:0,z:10*-v.x}),c.setAngularFactor({x:0,y:0,z:0}),h.position.copy(c.position)}}}(this.getCamera(),e.getNative(),r);var a=this.controls;if(this.getScene().add(this.controls.getObject()),"pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document){var n=document.body;this.pointerlockchange=function(){document.pointerLockElement===n||document.mozPointerLockElement===n||document.webkitPointerLockElement===n?(a.enabled=!0,r.block.fadeOut()):(a.enabled=!1,r.block.fadeIn())}}else console.warn("Your browser does not support the PointerLock WHS.API.");document.addEventListener("pointerlockchange",this.pointerlockchange,!1),document.addEventListener("mozpointerlockchange",this.pointerlockchange,!1),document.addEventListener("webkitpointerlockchange",this.pointerlockchange,!1),this.pointerlockerror=function(){console.warn("Pointer lock error.")},document.addEventListener("pointerlockerror",this.pointerlockerror,!1),document.addEventListener("mozpointerlockerror",this.pointerlockerror,!1),document.addEventListener("webkitpointerlockerror",this.pointerlockerror,!1),r.block.addEventListener("click",function(){if(n.requestPointerLock=n.requestPointerLock||n.mozRequestPointerLock||n.webkitRequestPointerLock,n.requestFullscreen=n.requestFullscreen||n.mozRequestFullscreen||n.mozRequestFullScreen||n.webkitRequestFullscreen,/Firefox/i.test(navigator.userAgent)){var e=function t(){(document.fullscreenElement===n||document.mozFullscreenElement===n||document.mozFullScreenElement===n)&&(document.removeEventListener("fullscreenchange",t),document.removeEventListener("mozfullscreenchange",t),n.requestPointerLock())};document.addEventListener("fullscreenchange",e,!1),document.addEventListener("mozfullscreenchange",e,!1),n.requestFullscreen()}else n.requestPointerLock()})},WHS.World.prototype.OrbitControls=function(e){if(this.controls=new THREE.OrbitControls(this.getCamera().getNative(),this.getRenderer().domElement),e)if(e._whsobject){var t=e?e.mesh.position:new THREE.Vector3(0,0,0);this.controls.target=t}else"object"==("undefined"==typeof e?"undefined":_typeof(e))?this.controls.target.copy(t):console.error("Object must be a THREE.JS vector! @OrbitControls")},WHS.Fog=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,e),WHS.API.extend(t,{hex:0,near:1,far:1e3}),this.fog=new THREE.Fog(t.hex,t.near,t.far),this.type="fog"}return _createClass(e,[{key:"addTo",value:function(e){e.scene.fog=this.fog}}]),e}(),WHS.World.prototype.Fog=function(e){var t=new WHS.Fog(e);return t.addTo(this),t},WHS.FogExp2=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,e),WHS.API.extend(t,{hex:0,density:25e-5}),this.fog=new THREE.FogExp2(t.hex,t.density),this.type="fogexp2"}return _createClass(e,[{key:"addTo",value:function(e){e.scene.fog=this.fog}}]),e}(),WHS.World.prototype.FogExp2=function(e){var t=new WHS.FogExp2(e);return t.addTo(this),t},WHS.Skybox=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,"skybox"));WHS.API.extend(e,{skyType:"box",detail:".png",radius:10,fog:!0,path:""});var a,n;switch(e.skyType){case"box":var o=["xpos","xneg","ypos","yneg","zpos","zneg"];a=new THREE.CubeGeometry(e.radius,e.radius,e.radius);for(var s=[],i=0;6>i;i++)s.push(new THREE.MeshBasicMaterial({map:THREE.ImageUtils.loadTexture(e.path+o[i]+e.imgSuffix),side:THREE.BackSide,fog:e.fog}));n=new THREE.MeshFaceMaterial(s);break;case"sphere":a=new THREE.SphereGeometry(e.radius/2,60,40),n=new THREE.MeshBasicMaterial({map:THREE.ImageUtils.loadTexture(e.path+e.imgSuffix),side:THREE.BackSide,fog:e.fog})}var l=new THREE.Mesh(a,n);return l.renderDepth=1e3,_get(Object.getPrototypeOf(t.prototype),"setNative",r).call(r,l),_get(Object.getPrototypeOf(t.prototype),"wrap",r).call(r),r}return _inherits(t,e),t}(WHS.Shape),WHS.World.prototype.Skybox=function(e){var t=new WHS.Skybox(e);return t.addTo(this),t};